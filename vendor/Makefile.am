NGINX_DIR = nginx-1.2.1
MRUBY_DIR = mruby-$(MRUBY_VERSION)

SUBDIRS = mruby

EXTRA_DIST =					\
	nginx					\
	$(NGINX_DIR)				\
	mruby					\
	$(MRUBY_DIR)

if WITH_GROONGA_HTTPD
NGINX_MAKEILE = $(NGINX_DIR)/Makefile
NGINX_MAKEFILE_DEPEND_FILES =			\
	nginx/configure				\
	Makefile.am				\
	$(top_builddir)/config.status		\
	$(top_srcdir)/src/nginx-module/config

$(NGINX_MAKEILE): $(NGINX_MAKEFILE_DEPEND_FILES)
	(cd nginx && \
	  $(SHELL) "$(abs_top_srcdir)/vendor/nginx/configure" \
	    `../../config.status --config`)

# nginx's Makefile specify 'build' as the default rule.
# This isn't compatible with the 'all' default rule generated by Automake
# So, override the all rule.
all-nginx: $(NGINX_MAKEILE)
	(cd $(NGINX_DIR) && $(MAKE) build)
all-local: all-nginx

clean-nginx: $(NGINX_MAKEILE)
	(cd $(NGINX_DIR) && $(MAKE) clean)
clean-local: clean-nginx

install-exec-nginx: $(NGINX_MAKEILE)
	(cd $(NGINX_DIR) && $(MAKE) install)
install-exec-local: install-exec-nginx
endif
