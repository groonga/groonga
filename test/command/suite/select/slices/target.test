plugin_register functions/time

table_create Tags TABLE_PAT_KEY ShortText

table_create Memos TABLE_NO_KEY
column_create Memos title COLUMN_SCALAR ShortText
column_create Memos date COLUMN_SCALAR Time
column_create Memos tag COLUMN_SCALAR Tags

column_create Tags memos_tag COLUMN_INDEX Memos tag

load --table Memos
[
{"title": "Groonga is fast!", "date": "2016-05-19 12:00:00", "tag": "Groonga"},
{"title": "Mroonga is fast!", "date": "2016-05-19 12:00:01", "tag": "Mroonga"},
{"title": "Groonga sticker!", "date": "2016-05-19 12:00:02", "tag": "Groonga"},
{"title": "Rroonga is fast!", "date": "2016-05-19 12:00:03", "tag": "Rroonga"}
]

select Memos \
  --filter 'date < "2016-05-19 12:00:02"' \
  --columns[day].stage output \
  --columns[day].type Time \
  --columns[day].value 'time_classify_day(date)' \
  --slices[groonga].target output \
  --slices[groonga].filter 'tag @ "Groonga"' \
  --slices[groonga].sort_keys 'date' \
  --slices[groonga].output_columns 'title, date, day'
