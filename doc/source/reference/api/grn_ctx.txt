.. -*- rst -*-

.. highlightlang:: none

``grn_ctx``
===========

Summary
-------

:c:type:`grn_ctx` is the most important object. :c:type:`grn_ctx`
keeps the current infomation such as:

* The last occurred error.
* The current encoding.
* The default thresholds. (e.g. :ref:`match-escalation-threshold`)
* The default command version. (See :doc:`/reference/command/command_version`)

:c:type:`grn_ctx` provides platform features such as:

* Memory management.
* Logging.

Most APIs receive :c:type:`grn_ctx` as the first argument.

You can't use the same :c:type:`grn_ctx` from two or more threads. You
need to create a :c:type:`grn_ctx` for a thread. You can use two or
more :c:type:`grn_ctx` in a thread but it is not needed for usual
use-case.

Example
-------

TODO...

Reference
---------

.. c:type:: grn_ctx

   TODO...

.. c:function:: grn_rc grn_ctx_init(grn_ctx *ctx, int flags)

   ctxを初期化します。

   :param ctx: 初期化するctx構造体へのポインタを指定します。
   :param flags: 初期化する ``ctx`` のオプションを指定します。
   :return: ``GRN_SUCCESS`` on success, not ``GRN_SUCCESS`` on error.

.. c:function:: grn_ctx *grn_ctx_open(int flags)

   初期化された :c:type:`grn_ctx` オブジェクトを返します。

   :c:func:`grn_ctx_init()` で初期化された :c:type:`grn_ctx` オブジェクトは構造体の実体をAPIの呼び元で確保するのに対して、 :c:func:`grn_ctx_open()` ではgroongaライブラリの内部で、実体を確保します。
   どちらで初期化された :c:type:`grn_ctx` も、 :c:func:`grn_ctx_fin()` で解放できます。
   :c:func:`grn_ctx_open()` で確保した :c:type:`grn_ctx` 構造体に関しては、:c:func:`grn_ctx_fin()` で解放した後に、その :c:type:`grn_ctx` で作成した :c:type:`grn_obj` を :c:func:`grn_obj_close()` によって解放しても問題ありません。

   :param flags: 初期化する ``ctx`` のオプションを指定します。
   :return: 初期化された :c:type:`grn_ctx` オブジェクトを返します。

.. c:function:: grn_rc grn_ctx_close(grn_ctx *ctx)

   It calls :c:func:`grn_ctx_fin()` and frees allocated memory for ``ctx`` by :c:func:`grn_ctx_open()`.

   :param ctx: no longer needed :c:type:`grn_ctx`.
   :return: ``GRN_SUCCESS`` on success, not ``GRN_SUCCESS`` on error.

.. c:function:: grn_rc grn_ctx_set_finalizer(grn_ctx *ctx, grn_proc_func *func)

   ctxを破棄するときに呼ばれる関数を設定します。

   :param ctx: 対象ctxを指定します。
   :param func: ``ctx`` を破棄するときに呼ばれる関数を指定します。
   :return: ``GRN_SUCCESS`` on success, not ``GRN_SUCCESS`` on error.

.. c:function:: grn_command_version grn_ctx_get_command_version(grn_ctx *ctx)

   command_versionを返します。

.. c:function:: grn_rc grn_ctx_set_command_version(grn_ctx *ctx, grn_command_version version)

   command_versionを変更します。

   :param version: 変更後のcommand_versionを指定します。

.. c:function:: long long int grn_ctx_get_match_escalation_threshold(grn_ctx *ctx)

   検索の挙動をエスカレーションする閾値を返します。

   エスカレーションの詳細は検索の仕様に関するドキュメントを参照してください。

.. c:function:: grn_rc grn_ctx_set_match_escalation_threshold(grn_ctx *ctx, long long int threshold)

   検索の挙動をエスカレーションする閾値を変更します。

   エスカレーションの詳細は検索の仕様に関するドキュメントを参照してください。

   :param threshold: 変更後の検索の挙動をエスカレーションする閾値を指定します。
